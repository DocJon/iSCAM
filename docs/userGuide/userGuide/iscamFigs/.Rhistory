ct
hake$CPUE
hake
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/LRGS.R",echo=TRUE)
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/EDOMwcvi.R",echo=TRUE)
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/EDOM_Map.r",echo=TRUE)
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/EDOMwcvi.R",echo=TRUE)
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/EDOMdemo.R",echo=TRUE)
exp
exp()
exp(1)
(1+10000/10)^10
(1+1/10)^10
n=1000
(1+1/n)^n
n=1e10
(1+1/n)^n
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/ForagingArena.R",echo=TRUE)
?text
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/ForagingArena.R",echo=TRUE)
R
plot(nt,R)
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/ForagingArena.R",echo=TRUE)
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/EDOMdemo.R",echo=TRUE)
a
b
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/EDOMdemo.R",echo=TRUE)
ni
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/EDOMdemo.R",echo=TRUE)
head(li)
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/EDOMdemo.R",echo=TRUE)
x
li
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/EDOMdemo.R",echo=TRUE)
fi
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/EDOMdemo.R",echo=TRUE)
ni
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/EDOMdemo.R",echo=TRUE)
ni
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/EDOMdemo.R",echo=TRUE)
ni
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/EDOMdemo.R",echo=TRUE)
ni
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/EDOMdemo.R",echo=TRUE)
require(Riscam)
read.admb
?read.admb
library(Riscam)
?read.admb
rm(Riscam)
require(Riscam)
read.admb
?read.rep
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/DataSets/StateSpaceSockeye.R",echo=TRUE)
dir()
examples(trellis)
example(lattice)
??lattice
RSiteSearch("MCMC trace plots")
data(NOdata)#
attach(NOdata)#
beta<-matrix(c(1.3, -0.1, 0.6, 0.1), 2, 2)#
sigma<-c(.02, .05)#
MH.out<-regmixMH(Equivalence, NO, beta = beta, s = sigma, #
                 sampsize = 2500, omega = .0013)#
plot(MH.out, summary.plots = TRUE, burnin = 2450, #
     alpha = 0.01)
qq(voice.part ~ height, aspect = 1, data = singer,#
   subset = (voice.part == "Bass 2" | voice.part == "Tenor 1"))
require(lattice)
qq(voice.part ~ height, aspect = 1, data = singer,#
   subset = (voice.part == "Bass 2" | voice.part == "Tenor 1"))
## volcano  ## 87 x 61 matrix#
wireframe(volcano, shade = TRUE,#
          aspect = c(61/87, 0.4),#
          light.source = c(10,0,10))
g <- expand.grid(x = 1:10, y = 5:15, gr = 1:2)#
g$z <- log((g$x^g$g + g$y^2) * g$gr)#
wireframe(z ~ x * y, data = g, groups = gr,#
          scales = list(arrows = FALSE),#
          drape = TRUE, colorkey = TRUE,#
          screen = list(z = 30, x = -60))
cloud(Sepal.Length ~ Petal.Length * Petal.Width | Species, data = iris,#
      screen = list(x = -90, y = 70), distance = .4, zoom = .6)
example(xyplot)
barley
A
x=rnorm(10000)
xplot(x)
xyplot(x)
x=1:10000
y=rnorm(length(x))
xplot(x,y)
xyplot(x,y)
?xyplot
xyplot(y~x)
xyplot(y~x,type="l")
qqmath(y)
xyplot(y~x,type="l")
y2=rnorm(length(x))
dd=cbind(x,y,y2)
xyplot(x,data=dd)
xyplot(~x,data=dd)
xyplot(dd[-1]~x,data=dd)
xyplot(dd[,-1]~x,data=dd)
xplot(y2)
demo(lattice)
singer
densityplot( ~ height | voice.part, data = singer, layout = c(2, 4),  #
+             xlab = "Height (inches)",#
+             ylab = "Kernel Density\n with Normal Fit",#
+             main = list("Estimated Density", cex = 1.4, col = "DarkOliveGreen"),#
+             panel = function(x, ...) {#
+                 panel.densityplot(x, ...)#
+                 panel.mathdensity(dmath = dnorm,#
+                                   args = list(mean=mean(x),sd=sd(x)))#
+             } )
x
densityplot(x)
densityplot(dd)
densityplot(~dd)
densityplot(~dd|x)
head(dd)
densityplot(~y|x)
?densityplot
densityplot(dd[,-1])
dd[-1]
dd[,-1]
example(densityplot)
head(singer)
is.data.frame(singer)
densityplot(dd~)
densityplot(dd~,data=dd)
densityplot(dd,data=dd)
densityplot(x~,data=dd)
densityplot(~x,data=dd)
is.data.frame(dd)
dd=as.data.frame(dd)
densityplot(~x,data=dd)
densityplot(~y,data=dd)
densityplot(~y2,data=dd)
densityplot(~x|y,data=dd)
densityplot(|y,data=dd)
densityplot(|x,data=dd)
densityplot(y,data=dd)
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.5,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
plot(fe,re, type="l")#
text(median(fe),ro, paste("Ro =",ro), pos=1)#
plot(fe,be, type="l")#
text(fe[imsy],be[imsy], paste("Bmsy =",round(be[imsy], 0)), pos=1)#
plot(fe,spr, type="l")#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.5,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
plot(fe,re, type="l")#
text(median(fe),ro, paste("Ro =",ro), pos=4)#
plot(fe,be, type="l")#
text(fe[imsy],be[imsy], paste("Bmsy =",round(be[imsy], 0)), pos=1)#
plot(fe,spr, type="l")#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.5,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
plot(fe,re, type="l")#
text(median(fe),ro, paste("Ro =",ro), pos=3)#
plot(fe,be, type="l")#
text(fe[imsy],be[imsy], paste("Bmsy =",round(be[imsy], 0)), pos=4)#
plot(fe,spr, type="l")#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.5,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
plot(fe,re, type="l")#
text(median(fe),ro, paste("Ro =",ro), pos=3)#
plot(fe,be, type="l")#
text(fe[imsy],be[imsy], paste("Bmsy =",round(be[imsy], 0)), pos=4)#
plot(fe,spr, type="l")#
text(fe[imsy],spr[imsy], paste("SPR at MSY =",round(spr[imsy], 0)), pos=4)#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.5,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
plot(fe,re, type="l")#
text(median(fe),ro, paste("Ro =",ro), pos=3)#
plot(fe,be, type="l")#
text(fe[imsy],be[imsy], paste("Bmsy =",round(be[imsy], 0)), pos=4)#
plot(fe,spr, type="l")#
text(fe[imsy],spr[imsy], paste("SPR at MSY =",round(spr[imsy], 3)), pos=4)#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.5,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
plot(fe,re, type="l",xlab="Umsy", ylab="Age-1 recruits")#
text(median(fe),ro, paste("Ro =",ro), pos=3)#
plot(fe,be, type="l",xlab="Umsy", ylab="Female biomass")#
text(fe[imsy],be[imsy], paste("Bmsy =",round(be[imsy], 0)), pos=4)#
plot(fe,spr, type="l",xlab="Umsy", ylab="SPR")#
text(fe[imsy],spr[imsy], paste("SPR at MSY =",round(spr[imsy], 3)), pos=4)#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.5,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
segments(fe[imsy],0, fe[imsy], ye[imsy])#
plot(fe,re, type="l",xlab="Umsy", ylab="Age-1 recruits")#
text(median(fe),ro, paste("Ro =",ro), pos=3)#
plot(fe,be, type="l",xlab="Umsy", ylab="Female biomass")#
text(fe[imsy],be[imsy], paste("Bmsy =",round(be[imsy], 0)), pos=4)#
plot(fe,spr, type="l",xlab="Umsy", ylab="SPR")#
text(fe[imsy],spr[imsy], paste("SPR at MSY =",round(spr[imsy], 3)), pos=4)#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.5,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
segments(fe[imsy],0, fe[imsy], ye[imsy],col="grey",lty=2)#
segments(0,ye[imsy], fe[imsy], ye[imsy],col="grey",lty=2)#
plot(fe,re, type="l",xlab="Umsy", ylab="Age-1 recruits")#
text(median(fe),ro, paste("Ro =",ro), pos=3)#
plot(fe,be, type="l",xlab="Umsy", ylab="Female biomass")#
text(fe[imsy],be[imsy], paste("Bmsy =",round(be[imsy], 0)), pos=4)#
plot(fe,spr, type="l",xlab="Umsy", ylab="SPR")#
text(fe[imsy],spr[imsy], paste("SPR at MSY =",round(spr[imsy], 3)), pos=4)#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.5,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
segments(fe[imsy],0, fe[imsy], ye[imsy],col="grey",lty=2)#
segments(0,ye[imsy], fe[imsy], ye[imsy],col="grey",lty=2)#
#
plot(fe,re, type="l",xlab="Umsy", ylab="Age-1 recruits")#
segments(fe[imsy],0, fe[imsy], re[imsy],col="grey",lty=2)#
segments(0,re[imsy], fe[imsy], re[imsy],col="grey",lty=2)#
#
text(median(fe),ro, paste("Ro =",ro), pos=3)#
plot(fe,be, type="l",xlab="Umsy", ylab="Female biomass")#
text(fe[imsy],be[imsy], paste("Bmsy =",round(be[imsy], 0)), pos=4)#
plot(fe,spr, type="l",xlab="Umsy", ylab="SPR")#
text(fe[imsy],spr[imsy], paste("SPR at MSY =",round(spr[imsy], 3)), pos=4)#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.5,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
segments(fe[imsy],0, fe[imsy], ye[imsy],col="grey",lty=2)#
segments(0,ye[imsy], fe[imsy], ye[imsy],col="grey",lty=2)#
#
plot(fe,re, type="l",xlab="Umsy", ylab="Age-1 recruits")#
text(median(fe),ro, paste("Ro =",ro), pos=3)#
segments(fe[imsy],0, fe[imsy], re[imsy],col="grey",lty=2)#
segments(0,re[imsy], fe[imsy], re[imsy],col="grey",lty=2)#
#
#
plot(fe,be/be[1], type="l",xlab="Umsy", ylab="Female biomass depletion")#
text(fe[imsy],be[imsy], paste("Bmsy =",round(be[imsy], 0)), pos=4)#
segments(fe[imsy],0, fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
segments(0,be[imsy]/be[1], fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
#
plot(fe,spr, type="l",xlab="Umsy", ylab="SPR")#
text(fe[imsy],spr[imsy], paste("SPR at MSY =",round(spr[imsy], 3)), pos=4)#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.5,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
segments(fe[imsy],0, fe[imsy], ye[imsy],col="grey",lty=2)#
segments(0,ye[imsy], fe[imsy], ye[imsy],col="grey",lty=2)#
#
plot(fe,re, type="l",xlab="Umsy", ylab="Age-1 recruits")#
text(median(fe),ro, paste("Ro =",ro), pos=3)#
segments(fe[imsy],0, fe[imsy], re[imsy],col="grey",lty=2)#
segments(0,re[imsy], fe[imsy], re[imsy],col="grey",lty=2)#
#
#
plot(fe,be/be[1], type="l",xlab="Umsy", ylab="Female biomass depletion")#
text(fe[imsy],be[imsy]/be[1], paste("Bmsy/Bo =",round(be[imsy]/be[1], 0)), pos=4)#
segments(fe[imsy],0, fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
segments(0,be[imsy]/be[1], fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
#
plot(fe,spr, type="l",xlab="Umsy", ylab="SPR")#
text(fe[imsy],spr[imsy], paste("SPR at MSY =",round(spr[imsy], 3)), pos=4)#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.5,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
segments(fe[imsy],0, fe[imsy], ye[imsy],col="grey",lty=2)#
segments(0,ye[imsy], fe[imsy], ye[imsy],col="grey",lty=2)#
#
plot(fe,re, type="l",xlab="Umsy", ylab="Age-1 recruits")#
text(median(fe),ro, paste("Ro =",ro), pos=3)#
segments(fe[imsy],0, fe[imsy], re[imsy],col="grey",lty=2)#
segments(0,re[imsy], fe[imsy], re[imsy],col="grey",lty=2)#
#
#
plot(fe,be/be[1], type="l",xlab="Umsy", ylab="Female biomass depletion")#
text(fe[imsy],be[imsy]/be[1], paste("Bmsy/Bo =",round(be[imsy]/be[1], 3)), pos=4)#
segments(fe[imsy],0, fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
segments(0,be[imsy]/be[1], fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
#
plot(fe,spr, type="l",xlab="Umsy", ylab="SPR")#
text(fe[imsy],spr[imsy], paste("SPR at MSY =",round(spr[imsy], 3)), pos=4)#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.5,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
segments(fe[imsy],0, fe[imsy], ye[imsy],col="grey",lty=2)#
segments(0,ye[imsy], fe[imsy], ye[imsy],col="grey",lty=2)#
#
plot(fe,re, type="l",xlab="Umsy", ylab="Age-1 recruits")#
text(median(fe),ro, paste("Ro =",ro), pos=3)#
segments(fe[imsy],0, fe[imsy], re[imsy],col="grey",lty=2)#
segments(0,re[imsy], fe[imsy], re[imsy],col="grey",lty=2)#
#
#
plot(fe,be/be[1], type="l",xlab="Umsy", ylab="Female biomass depletion")#
text(fe[imsy],be[imsy]/be[1], paste("Bmsy/Bo =",round(be[imsy]/be[1], 3)), pos=4)#
segments(fe[imsy],0, fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
segments(0,be[imsy]/be[1], fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
#
plot(fe,spr, type="l",xlab="Umsy", ylab="SPR")#
text(fe[imsy],spr[imsy], paste("SPR at MSY =",round(spr[imsy], 3)), pos=4)#
segments(fe[imsy],0, fe[imsy], spr[imsy],col="grey",lty=2)#
segments(0,spr[imsy], fe[imsy], spr[imsy],col="grey",lty=2)#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.3,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
segments(fe[imsy],0, fe[imsy], ye[imsy],col="grey",lty=2)#
segments(0,ye[imsy], fe[imsy], ye[imsy],col="grey",lty=2)#
#
plot(fe,re, type="l",xlab="Umsy", ylab="Age-1 recruits")#
text(median(fe),re[imsy], paste("Ro =",ro), pos=3)#
segments(fe[imsy],0, fe[imsy], re[imsy],col="grey",lty=2)#
segments(0,re[imsy], fe[imsy], re[imsy],col="grey",lty=2)#
#
#
plot(fe,be/be[1], type="l",xlab="Umsy", ylab="Female biomass depletion")#
text(fe[imsy],be[imsy]/be[1], paste("Bmsy/Bo =",round(be[imsy]/be[1], 3)), pos=4)#
segments(fe[imsy],0, fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
segments(0,be[imsy]/be[1], fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
#
plot(fe,spr, type="l",xlab="Umsy", ylab="SPR")#
text(fe[imsy],spr[imsy], paste("SPR at MSY =",round(spr[imsy], 3)), pos=4)#
segments(fe[imsy],0, fe[imsy], spr[imsy],col="grey",lty=2)#
segments(0,spr[imsy], fe[imsy], spr[imsy],col="grey",lty=2)#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.3,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
segments(fe[imsy],0, fe[imsy], ye[imsy],col="grey",lty=2)#
segments(0,ye[imsy], fe[imsy], ye[imsy],col="grey",lty=2)#
#
plot(fe,re, type="l",xlab="Umsy", ylab="Age-1 recruits")#
text(median(fe),re[imsy], paste("Ro =",ro, "\nRmsy/Ro ="/re[imsy]/ro), pos=3)#
segments(fe[imsy],0, fe[imsy], re[imsy],col="grey",lty=2)#
segments(0,re[imsy], fe[imsy], re[imsy],col="grey",lty=2)#
#
#
plot(fe,be/be[1], type="l",xlab="Umsy", ylab="Female biomass depletion")#
text(fe[imsy],be[imsy]/be[1], paste("Bmsy/Bo =",round(be[imsy]/be[1], 3)), pos=4)#
segments(fe[imsy],0, fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
segments(0,be[imsy]/be[1], fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
#
plot(fe,spr, type="l",xlab="Umsy", ylab="SPR")#
text(fe[imsy],spr[imsy], paste("SPR at MSY =",round(spr[imsy], 3)), pos=4)#
segments(fe[imsy],0, fe[imsy], spr[imsy],col="grey",lty=2)#
segments(0,spr[imsy], fe[imsy], spr[imsy],col="grey",lty=2)#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.3,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
segments(fe[imsy],0, fe[imsy], ye[imsy],col="grey",lty=2)#
segments(0,ye[imsy], fe[imsy], ye[imsy],col="grey",lty=2)#
#
plot(fe,re, type="l",xlab="Umsy", ylab="Age-1 recruits")#
text(median(fe),re[imsy], paste("Ro =",ro, "\nRmsy/Ro =", round(re[imsy]/ro, 3)), pos=3)#
segments(fe[imsy],0, fe[imsy], re[imsy],col="grey",lty=2)#
segments(0,re[imsy], fe[imsy], re[imsy],col="grey",lty=2)#
#
#
plot(fe,be/be[1], type="l",xlab="Umsy", ylab="Female biomass depletion")#
text(fe[imsy],be[imsy]/be[1], paste("Bmsy/Bo =",round(be[imsy]/be[1], 3)), pos=4)#
segments(fe[imsy],0, fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
segments(0,be[imsy]/be[1], fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
#
plot(fe,spr, type="l",xlab="Umsy", ylab="SPR")#
text(fe[imsy],spr[imsy], paste("SPR at MSY =",round(spr[imsy], 3)), pos=4)#
segments(fe[imsy],0, fe[imsy], spr[imsy],col="grey",lty=2)#
segments(0,spr[imsy], fe[imsy], spr[imsy],col="grey",lty=2)#
#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
setwd('/Users/stevenmartell/Documents/REVIEWS/POP Assessment')
#POPReview.R#
#
#Equilibrium sex structured model to explore reference points#
#for the POP assessment.#
#
#s = index for sex 1=females,  2=males#
A=60  #age of plus group.#
age=1:A#
s=1:2#
show=T#
discrete=T#
#PARAMETERS#
ro		<- 20507#
h		<- 0.754#
kap		<- 4*h/(1-h)#
m		<- c(0.067, 0.073)#
mu		<- 12.4#
delta	<- 0.39#
log.vl	<- 3.52#
linf	<- c(45.11, 41.62)#
k		<- c(0.1404, 0.1675)#
to		<- c(-1.3035, -1.0210)#
a		<- c(9.26e-6, 8.13e-6)#
b		<- c(3.116, 3.155)#
ma		<- c(0, 0, 0, 0, 0.023, #
			0.034, 0.096, 0.211, 0.341, 0.465, #
			0.601, 0.738, 0.860, 0.950, 0.996, #
			rep(1.000,length=45))#
#
theta=list(ro=ro, h=h, m=m, mu=mu, delta=delta, log.vl=log.vl, #
			linf=linf, k=k, to=to, a=a, b=b, ma=ma)#
#
#PROCEDURES#
par(mfcol=c(2, 2))#
equil.age <- function(theta, fe=0)#
{#
	#Double logistic selectivity#
	sa = exp(-(age-mu)^2/exp(log.vl))  #female#
	sa = cbind(sa,exp(-(age-mu+delta)^2/exp(log.vl)) )  #male baseed on delta offset#
	sa[age>mu, 1]=1#
	sa[age>(mu+delta), 2]=1#
	#
	#
	#Growth#
	la=sapply(s, function(s)linf[s]*(1-exp(-k[s]*(age-to[s]))))#
	wa=sapply(s, function(s)a[s]*la[,s]^b[s])#
	fa=ma*wa[,1]#
	#
	#
	#Incidence functions#
	lx = sapply(s, function(s) exp(-m[s])^(age-1))#
	lx[A,]=lx[A,]/(1-exp(-m))	#plus group#
	phie = sum(0.5*lx[,1]*fa)		#female eggs per recruit#
	#
	#
	#Stock recruitment parameters for beverton-holt model#
	so=kap/phie#
	beta=(kap-1)/(ro*phie)#
	#
	lz = matrix(0, nrow=A, ncol=2)#
	#Fished conditions (instantaneous rates)#
	#fe=0.0#
	za = t(m + fe*t(sa))#
	oa = 1-exp(-za)#
	qa = (sa/za)*oa#
	#
	lz[1, ] = 1.0#
	for(i in 2:A)#
	{#
		lz[i,] = lz[i-1, ]*exp(-za[i-1, ])#
		if(i==A) lz[i,]=lz[i, ]/(1-exp(-za[i, ]))#
	}#
	#
	#Fished conditions (discrete rates)#
	if(discrete){#
		lz[i, ] = 1.0#
		oa = (1-t(fe*t(sa)))#
		qa=sa#
		for(i in 2:A)#
		{#
			lz[i, ]=(lz[i-1, ]*exp(-m/2)*oa[i,])*exp(-m/2)#
			if(i==A) lz[i,]=lz[i, ]/(1-(exp(-m/2)*oa[i,])*exp(-m/2))#
		}#
	}#
	#
	phif = sum(0.5*lz[, 1]*fa)		#fished female eggs per recruit#
	phiq = sum(0.5*lz*wa*qa)#
	print(phiq)#
	#
	re = max(ro*(kap-phie/phif)/(kap-1), 0)#
	be = re*phif#
	ye = fe*re*phiq#
	spr = phif/phie#
	#
	#
	#
	#
	#Graphics#
	if(show)#
	{#
		matplot(age, sa, type="l", xlim=c(0, 20),xlab="Age", ylab="Selectivity")#
		matplot(age, la, type="o")#
		matplot(age, wa, type="o")#
		matlines(age, fa, type="l", col=3)#
		matplot(age, lx, type="l",xlab="Age", ylab="Survivorship")#
		matlines(age, lz, col=3:4)#
	}#
	#
	return(list(ye=ye, re=re, be=be, spr=spr))#
}#
show=TRUE#
equil.age(theta, 0)#
show=FALSE#
fe=seq(0,0.3,by=0.001)#
ee=as.data.frame(t(sapply(fe,equil.age,theta=theta)))#
ye=unlist(ee[,1])#
re=unlist(ee[,2])#
be=unlist(ee[,3])#
spr=unlist(ee[,4])#
#
imsy= which(ye==max(ye))#
#
plot(fe,ye, type="l",xlab="Umsy", ylab="Yield")#
text(median(fe),ye[imsy],paste("Umsy =", fe[imsy],"\nMSY =", round(ye[imsy], 0)), pos=1)#
segments(fe[imsy],0, fe[imsy], ye[imsy],col="grey",lty=2)#
segments(0,ye[imsy], fe[imsy], ye[imsy],col="grey",lty=2)#
#
plot(fe,re, type="l",xlab="Umsy", ylab="Age-1 recruits")#
text(median(fe),re[imsy], paste("Ro =",ro, "\nRmsy/Ro =", round(re[imsy]/ro, 3)), pos=3)#
segments(fe[imsy],0, fe[imsy], re[imsy],col="grey",lty=2)#
segments(0,re[imsy], fe[imsy], re[imsy],col="grey",lty=2)#
#
#
plot(fe,be/be[1], type="l",xlab="Umsy", ylab="Female biomass depletion")#
text(fe[imsy],be[imsy]/be[1], paste("Bmsy/Bo =",round(be[imsy]/be[1], 3)), pos=4)#
segments(fe[imsy],0, fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
segments(0,be[imsy]/be[1], fe[imsy], be[imsy]/be[1],col="grey",lty=2)#
#
plot(fe,spr, type="l",xlab="Umsy", ylab="SPR")#
text(fe[imsy],spr[imsy], paste("SPR at MSY =",round(spr[imsy], 3)), pos=4)#
segments(fe[imsy],0, fe[imsy], spr[imsy],col="grey",lty=2)#
segments(0,spr[imsy], fe[imsy], spr[imsy],col="grey",lty=2)#
dev.copy2eps(file="Equil.age.eps")#
#
print(paste("Fmsy =", fe[imsy]))#
print(paste("MSY =", round(ye[imsy], 0)))#
print(paste("Rmsy =", round(re[imsy], 0)))#
print(paste("Bmsy =", round(be[imsy], 0)))#
print(paste("SPRmsy =", round(spr[imsy], 3)))
dir()
q()
26.7/(4+26.7)
467/(4+467)
x=1:(50*12)
x
plot(sin(2*x*pi))
mu = 1:12
std = 0.1*mu
mu
dnorm(x,mu,std)
mu
std
x
x=rnorm(60)
require(mvrmt)
??multivariate
reqiure(MASS)
require(MASS)
n=1
b=1000
c=500
b=b-c
b
b=1000
b/(1+c/b)
n=2
for(i in 1:n)b=b/(1+c/(n*b))
b
b=1000
n=25
for(i in 1:n)b=b/(1+c/(n*b))
b
n=250
for(i in 1:n)b=b/(1+c/(n*b))
b
b=1000
for(i in 1:n)b=b/(1+c/(n*b))
b
b=1000
b*(1-c/b)
b/(1+c/(n*b))^n
n
b/(1+c/n*b)^n
b
source("/Users/stevenmartell/Downloads/PVA example.R",echo=TRUE)
N0=100
source("/Users/stevenmartell/Downloads/PVA example.R",echo=TRUE)
source("/Users/stevenmartell/Documents/UBC Courses/Fish 504/Tutorials2010/EDOMdemo.R",echo=TRUE)
source("/Users/stevenmartell/Documents/UBC Courses/Fish 505/FISH 505 2009/Tutorials/EDOM.R",echo=TRUE)
ps
pi
round(pi,19)
?round
signif(pi,15)
dnorm(0.1,0.1,1,log=T)
-dnorm(0.1,0.1,1,log=T)
-dnorm(0.1,0.0,1,log=T)
-dnorm(req(0,length=10),0,1,log=T)
-dnorm(rep(0,length=10),0,1,log=T)
sum(-dnorm(rep(0,length=10),0,1,log=T))
-dnorm(rep(0,length=10),0,0.5,log=T)
sum(-dnorm(rep(0,length=10),0,0.5,log=T))
require(hacks)
x=seq(0,1,by=0.01)
plot(x,dbeta((x-0.2)/0.8,1.01,1.01))
plot(x,dbeta((x-0.2)/0.8,1.01,1.01),type="l")
lines(x,dbeta((x-0.2)/0.8,2,1.01),type="l")
dunif(x)
dunif(x,-10,10,T)
dunif(x,-10,10)
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/var/folders/6x/6xkLW0-9EO0g+R9VgTVV9U+++TM/-Tmp-//RtmpkNLhDx/file5f728cf0")#
unlink("/var/folders/6x/6xkLW0-9EO0g+R9VgTVV9U+++TM/-Tmp-//RtmpkNLhDx/file5f728cf0")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
ls
ls()
source("/Users/stevenmartell/Documents/CURRENT PROJECTS/iSCAM/iSCAM UG working copy/iscamFigs/priorDistn.R")
ls()
dir()
source("/var/folders/6x/6xkLW0-9EO0g+R9VgTVV9U+++TM/-Tmp-//RtmpkNLhDx/file59831184")#
unlink("/var/folders/6x/6xkLW0-9EO0g+R9VgTVV9U+++TM/-Tmp-//RtmpkNLhDx/file59831184")
